<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="style.css">
  <title>Webshop</title>
</head>
<body>
  <h1>Onze Producten</h1>

  <!-- Filter Section -->
  <div id="filters">
    <h2>Filters</h2>
    <div id="dynamicFilters"></div>
    <button onclick="applyFilters()">Toepassen</button>
  </div>

  <!-- Product Grid -->
  <div class="grid" id="productGrid"></div>

  <script>
    // Load filters dynamically from /api/filters
    async function loadFilters() {
      try {
        const response = await fetch('/api/filters');
        const data = await response.json();
        const dynamicFilters = document.getElementById('dynamicFilters');

        // Iterate over all filter properties returned by the API
        for (const [key, value] of Object.entries(data.filters)) {
          const filterContainer = document.createElement('div');
          filterContainer.className = 'filter-container';

          // Create a label for the filter
          const label = document.createElement('h3');
          label.textContent = key.charAt(0).toUpperCase() + key.slice(1);
          filterContainer.appendChild(label);

          // Handle price filter (slider)
          if (key === 'price') {
            const min = value.min;
            const max = value.max;

            const rangeInput = document.createElement('input');
            rangeInput.type = 'range';
            rangeInput.id = `filter-${key}`;
            rangeInput.min = min;
            rangeInput.max = max;
            rangeInput.value = max;
            rangeInput.step = 1;

            const rangeLabel = document.createElement('span');
            rangeLabel.id = `filter-${key}-value`;
            rangeLabel.textContent = `${min} - ${max}`;

            rangeInput.addEventListener('input', () => {
              rangeLabel.textContent = `${min} - ${rangeInput.value}`;
            });

            filterContainer.appendChild(rangeInput);
            filterContainer.appendChild(rangeLabel);
          }
          // Handle other filters (multi-select checkboxes)
          else if (Array.isArray(value)) {
            value.forEach(option => {
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.value = option;
              checkbox.id = `filter-${key}-${option}`;

              const checkboxLabel = document.createElement('label');
              checkboxLabel.htmlFor = `filter-${key}-${option}`;
              checkboxLabel.textContent = option;

              filterContainer.appendChild(checkbox);
              filterContainer.appendChild(checkboxLabel);
              filterContainer.appendChild(document.createElement('br'));
            });
          }

          dynamicFilters.appendChild(filterContainer);
        }
      } catch (error) {
        console.error('Error loading filters:', error);
      }
    }

    // Apply filters and reload products
    async function applyFilters() {
      const queryParams = new URLSearchParams();

      // Get all filter inputs
      const filterInputs = document.querySelectorAll('#dynamicFilters input');
      filterInputs.forEach(input => {
        if (input.type === 'range') {
          // Add range filter (e.g., price)
          queryParams.append(input.id.replace('filter-', ''), input.value);
        } else if (input.type === 'checkbox' && input.checked) {
          // Add checkbox filters (e.g., brands, materials)
          const [key] = input.id.replace('filter-', '').split('-');
          queryParams.append(key, input.value);
        }
      });

      const response = await fetch(`/api/products?${queryParams.toString()}`);
      const data = await response.json();

      const grid = document.getElementById('productGrid');
      grid.innerHTML = ''; // Clear existing products

      data.products.forEach(product => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        let content = "";

        // Product title
        content += `<h2>${product.name || 'Product'}</h2>`;

        // Product image
        const imgUrl = '/images/' + encodeURIComponent(product.id || '0') + '.png';
        content += `<img src="${imgUrl}" alt="${product.name || '0'}">`;

        // Display product properties
        for (const [key, value] of Object.entries(product)) {
          if (key === 'name' || key === 'id') continue; // Skip name and id

          // Format the label (e.g., 'price' -> 'Price')
          const label = key.charAt(0).toUpperCase() + key.slice(1);

          // Check if the value is an array
          if (Array.isArray(value)) {
            // Display label with a list of values
            content += `<p><strong>${label}:</strong></p><ul>`;
            value.forEach(item => {
              content += `<li>${item}</li>`;
            });
            content += `</ul>`;
          } else {
            // Display label with a single value
            content += `<p><strong>${label}:</strong> ${value}</p>`;
          }
        }

        tile.innerHTML = content;
        grid.appendChild(tile);
      });
    }

    // Load filters and products on page load
    loadFilters();
    applyFilters();
  </script>

  <hr>
  <p>Deze webshop is een opdracht van het vak informatica</p>
</body>
</html>
